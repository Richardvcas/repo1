
apiVersion: batch/v1
kind: Job
metadata:
  name: restart-wh-labocp-007
  namespace: gkp
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded
spec:
  template:
    spec:
      serviceAccountName: vm-automation-sa
      containers:
        - name: restart-vm
          image: quay.io/openshift/origin-cli:4.12
          command:
            - /bin/bash
            - -c
            - |
              echo "Stopping VM..."
              oc patch vm wh-labocp-007 -n gkp --type=merge -p '{"spec":{"running":false}}'
              sleep 15
              echo "Starting VM..."
              oc patch vm wh-labocp-007 -n gkp --type=merge -p '{"spec":{"running":true}}'
      restartPolicy: Never


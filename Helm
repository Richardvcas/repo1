https://gitlab.lab.vks.net/V849212/vm-helm.git

charts > vm-chart (chart.yaml, values.yaml) > templates > vm.yaml
vms (Nothing inside)

chart.yaml

apiVersion: v2
name: vm-deployment
description: Helm chart to deploy VM in OpenShift Virtualization
version: 0.1.0


values.yaml
vm_name: myvm
namespace: gkp
volume_name: myvm-rootdisk
diskname: myvm-disk
image_url: http://10.14.222.30:8080/rhel-8.10-x86_64-kvm.qcow2
storage_size: 30Gi
status: true
cpu: 4
memory: 8Gi
interface: default
ip: 10.14.21.134

vm.yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  labels:
    kubevirt.io/vm: {{ .Values.vm_name }}
  name: {{ .Values.vm_name }}
spec:
  dataVolumeTemplates:
  - metadata:
      name: {{ .Values.volume_name }}
    spec:
      storage:
        resources:
          requests:
            storage: {{ .Values.storage_size }}
        # storageClassName: ocs-storagecluster-ceph-rbd
        storageClassName: ocs-storagecluster-ceph-rbd-virtualization
      source:
        http:
          url: {{ .Values.image_url }}
            #registry:
            #url: docker://fred31420.gielab.jpmchase.net:8443/jpmc/ovlt_rhel_9:9.6.1_2025-07-09-100051
            #secretRef: fred31420-data-source-secret
            #certConfigMap: fred31420-tls-certs    
  running: {{ .Values.status }}
  template:
    metadata:
      labels:
        kubevirt.io/vm: {{ .Values.vm_name }}
    spec:
      domain:
        firmware:
          bootloader:
            efi:
              secureBoot: false
        devices:
          interfaces:
            - name: {{ .Values.interface }}
              bridge: {{}}
          disks:
          - disk:
              bus: virtio
            name: rootdisk          
          - disk:
              bus: virtio
            name: cloudinitdisk
        machine:
          type: ""
        cpu:
          cores: {{ .Values.cpu }}
        resources:
          requests:
            memory: {{ .Values.memory }}
      terminationGracePeriodSeconds: 180
      networks:
        - name: {{ .Values.interface }}
          multus:
            networkName: default/vlan3702
      volumes:
      - dataVolume:
          name: {{ .Values.volume_name }}
        name: rootdisk           
      - name: cloudinitdisk
        cloudInitNoCloud:          
          networkData: |
            version: 2
            ethernets:
              eth0:
                dhcp4: false
                addresses:
                  - {{ .Values-ip }}
                gateway4: 10.14.221.129
                nameservers:
                  addresses:
                    - 10.240.47.3
                    - 10.240.41.3
          userData: |-
            user: cloud-user
            password: 'a23456'
            chpasswd: { "expire": False }






